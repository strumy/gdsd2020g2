{% extends "base.twig" %}

{% block headtags %}
    <script src="{{ path_url }}/vendor/components/jquery/jquery.min.js" type="text/javascript"></script>
    <link href="{{ path_url }}/vendor/components/jqueryui/themes/smoothness/jquery-ui.min.css" rel="stylesheet" type="text/css" media="screen"/>
    <script src="{{ path_url }}/vendor/components/jqueryui/jquery-ui.min.js" type="text/javascript"></script>

    <script type="text/javascript">
        $(document).ready(function()
        {
            $("#errors").hide();
        });
    </script>
{% endblock %}

{% block body %}

    {% if session.get('is_authenticated') %}
        <!-- Page Content -->
        <div class="container">

            <div class="row">
                <div class="col-lg-3">
                    <h2 class="my-4">{{ title }}</h2>
                    <div class="list-group">
                        <a href="userhome.php?section=products" class="list-group-item {% if data.section == null or data.section == 'products' %}active{% endif %}">Products</a>
                        {% if session.get('user_info').utype == 'ADMIN' %}
                        <a href="userhome.php?section=users" class="list-group-item {% if data.section == 'users' %}active{% endif %}">Users</a>
                        {% endif %}
                        <a href="userhome.php?section=messages" class="list-group-item {% if data.section == 'messages' %}active{% endif %}">Messages</a>
                    </div>
                </div>
                {% if (data.section == null or data.section == 'products') and session.get('user_info').utype == 'ADMIN' %}
                <div class="col-lg-9">
                    <h3 class="my-4">{{ body }}</h3>
                    <div class="card mb-2 mt-1">
                        <div class="card-body bg-light text-dark">
                            <h2 class="card-title p-1">Products</h2>
                        </div>
                    </div>
                    <div class="card-body bg-light text-dark">
                    <table class="table">
                        <thead>
                        <tr>
                            <th>#Id</th>
                            <th>Product Name</th>
                            <th>Created On</th>
                            <th>Created By</th>
                            <th>Category</th>
                            <th>Price</th>
                            <th>Status</th>
                            <th>Toggle Status</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for product in data.productlist %}
                            <tr>
                                <th>{{ product.post_id }}</th>
                                <td><a class="text-primary" href="item_detail.php?post_id={{ product.post_id }}&author_id={{ product.author_id }}">{{ product.title }}</a></td>
                                <td>{{ product.date_inserted }}</td>
                                <td>{{ product.full_name }}</td>
                                <td>{{ product.market_category }}</td>
                                <td>{{ product.Price }} &euro;</td>
                                <td><i>{{ product.Status }}</i></td>
                                <td>{% if product.Status == 'available' %}<a class="btn btn-warning btn-md mr-1 mb-2 waves-effect waves-light" href="userhome.php?section=products&action=toggleStatus&post_id={{ product.post_id }}&status={{ product.Status }}">Disable</a>{% elseif product.Status == 'pending' %}<a class="btn btn-info btn-md mr-1 mb-2 waves-effect waves-light" href="userhome.php?section=products&action=toggleStatus&post_id={{ product.post_id }}&status={{ product.Status }}">Enable</a>{% endif %}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                    </div>
                </div>
                {% endif %}
                {% if data.section == 'users' and session.get('user_info').utype == 'ADMIN' %}
                    <div class="col-lg-9">
                        <h3 class="my-4">{{ body }}</h3>
                        <div class="card mb-2 mt-1">
                            <div class="card-body bg-light text-dark">
                                <h2 class="card-title p-1">Users</h2>
                            </div>
                        </div>

                        <table>
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>Full Name</th>
                                <th>Email</th>
                                <th>Username</th>
                                <th>User Type</th>
                                <th>Gender</th>
                                <th>User Status</th>
                                <th>Last Login Date</th>
                                <th>Date Inserted</th>
                                <th>Date Updated</th>
                                <th>Toggle Admin/Normal User</th>
                                <th>Enable/Disable</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for user in data.userlist %}
                            <tr>
                                <th>{{ user.id }}</th>
                                <td>{{ user.full_name }}</td>
                                <td>{{ user.email }}</td>
                                <td>{{ user.user_name }}</td>
                                <td>{{ user.utype }}</td>
                                <td>{{ user.gender }}</td>
                                <td>{% if user.ustatus == 1 %}Enabled{% elseif user.ustatus == 0 %}Disabled{% elseif user.ustatus == 2 %}Deleted{% endif %}</td>
                                <td>{{ user.date_lastlogin }}</td>
                                <td>{{ user.date_inserted }}</td>
                                <td>{{ user.date_updated }}</td>
                                <td>{% if user.utype != "ADMIN" %}<a href="userhome.php?section=users&action=makeadmintoggle&uid={{ user.id }}&utype={{ user.utype }}">Make Admin</a>{% else %}<a href="userhome.php?section=users&action=makeadmintoggle&uid={{ user.id }}&utype={{ user.utype }}">Make Normal User</a>{% endif %}</td>
                                <td>{% if user.ustatus == 1 %}<a href="userhome.php?section=users&action=ustatus&uid={{ user.id }}&ustatus={{ user.ustatus }}">Disable</a> {% else %}<a href="userhome.php?section=users&action=ustatus&uid={{ user.id }}&ustatus={{ user.ustatus }}">Enable</a>{% endif %}</td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% endif %}
                {% if data.section == 'messages' %}
                <div class="col-lg-9">
                    <h3 class="my-4">{{ body }}</h3>
                    <div class="card mb-2 mt-1">
                        <div class="card-body bg-light text-dark">
                            <h2 class="card-title p-1">Inbox</h2>
                        </div>
                    </div>
                    {% for message in data.inboxmessages %}
                    <div class="card mb-4">
                        <div class="card-body">
                            <h2 class="card-title h5">Message from {{ message.full_name }}</h2>
                            <p class="card-text">{{ message.body }}</p>
                            <a href="{% if session.get('is_authenticated') %}message.php?post_id={{ message.id_product }}&author_id={{ message.id_sender }} {% else %} login.php?m=m{% endif %}" class="btn btn-primary">Reply</a>
                        </div>
                    </div>
                    {% endfor %}
                    <div class="card mb-2 mt-1">
                        <div class="card-body bg-light text-dark">
                            <h2 class="card-title p-1">Sent Messages</h2>
                        </div>
                    </div>
                    {% for message in data.sentmessages %}
                        <div class="card mb-4">
                            <div class="card-body">
                                <h2 class="card-title h5">Message to {{ message.full_name }}</h2>
                                <p class="card-text">{{ message.body }}</p>
                                <a href="{% if session.get('is_authenticated') %}message.php?post_id={{ message.id_product }}&author_id={{ message.id_receiver }} {% else %} login.php?m=m{% endif %}" class="btn btn-primary">Reply</a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

        </div>
        <!-- /.container -->

    {% endif %}
{% endblock %}
